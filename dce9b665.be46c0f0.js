(window.webpackJsonp=window.webpackJsonp||[]).push([[30],{166:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return r})),n.d(t,"metadata",(function(){return c})),n.d(t,"rightToc",(function(){return l})),n.d(t,"default",(function(){return b}));var a=n(1),o=n(9),i=(n(0),n(175)),r={id:"ilcbsetup",title:"Setup a JATOS service",sidebar_label:"ILCB Server Setup"},c={id:"ilcbsetup",title:"Setup a JATOS service",description:"## A JATOS server for online experiments",source:"@site/docs/ilcbsetup.md",permalink:"/docs/ilcbsetup",editUrl:"https://github.com/lpc-cnrs-amu/online-xp-docs/blob/master/website-docusaurus/docs/ilcbsetup.md",sidebar_label:"ILCB Server Setup",sidebar:"ILCBSidebar",previous:{title:"How to start",permalink:"/docs/ilcbhowto"},next:{title:"Frequently asked questions",permalink:"/docs/faq"}},l=[{value:"A JATOS server for online experiments",id:"a-jatos-server-for-online-experiments",children:[]},{value:"Tutorials",id:"tutorials",children:[]},{value:"DigitalOcean manipulations",id:"digitalocean-manipulations",children:[{value:"Droplet creation",id:"droplet-creation",children:[]},{value:"Initial server configuration",id:"initial-server-configuration",children:[]}]},{value:"Apache configuration",id:"apache-configuration",children:[{value:"Initial steps",id:"initial-steps",children:[]},{value:"Encryption",id:"encryption",children:[]}]},{value:"Install Java",id:"install-java",children:[]},{value:"Setup MySQL for JATOS",id:"setup-mysql-for-jatos",children:[{value:"Setup PhpMyAdmin or Adminer",id:"setup-phpmyadmin-or-adminer",children:[]}]},{value:"Install JATOS",id:"install-jatos",children:[{value:"Download",id:"download",children:[]},{value:"Enable JATOS service after reboot",id:"enable-jatos-service-after-reboot",children:[]}]},{value:"Useful command lines",id:"useful-command-lines",children:[]}],s={rightToc:l};function b(e){var t=e.components,n=Object(o.a)(e,["components"]);return Object(i.b)("wrapper",Object(a.a)({},s,n,{components:t,mdxType:"MDXLayout"}),Object(i.b)("h2",{id:"a-jatos-server-for-online-experiments"},"A JATOS server for online experiments"),Object(i.b)("p",null,Object(i.b)("em",{parentName:"p"},Object(i.b)("strong",{parentName:"em"},"Doc written in April 2020"))),Object(i.b)("p",null,"How was this JATOS server built ?"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},"I chose ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"https://www.digitalocean.com"}),"https://www.digitalocean.com")," to host a cloud based server. I selected the LAMP option that comes with a pre-installed version of PHP, MySQL and Apache, along with a few extras, under Ubuntu 18.0.4. This was setup in minutes, and I had an IP address to log to with ssh.")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},"a domain name was chosen from ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"https://www.gandi.net"}),"https://www.gandi.net")," and linked to the IP address of the web server."))),Object(i.b)("h2",{id:"tutorials"},"Tutorials"),Object(i.b)("p",null,"There are many routes that lead to an up and running JATOS server. One can choose a much more ",Object(i.b)("strong",{parentName:"p"},Object(i.b)("a",Object(a.a)({parentName:"strong"},{href:"https://www.jatos.org/JATOS-on-DigitalOcean.html"}),"simple docker-style installation"))," than the one described here. I went the ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"https://www.jatos.org/JATOS-with-Apache.html"}),"old-school way with Apache"),". Why ? Because we wanted to have JATOS on a portal for experiments, along with other services. This took me a few weeks to configure as I am no professional. If I had to set it up again, the whole process would take less than a day - well, starting early in the morning."),Object(i.b)("p",null,"The DigitalOcean tutorials I followed were"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("a",Object(a.a)({parentName:"li"},{href:"https://www.digitalocean.com/community/tutorials/initial-server-setup-with-ubuntu-18-04"}),"How to setup a server with Ubuntu 18.04")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("a",Object(a.a)({parentName:"li"},{href:"https://www.digitalocean.com/community/tutorials/how-to-set-up-apache-virtual-hosts-on-ubuntu-16-04"}),"How to setup virtual hosts")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("a",Object(a.a)({parentName:"li"},{href:"https://www.digitalocean.com/community/tutorials/how-to-secure-apache-with-let-s-encrypt-on-ubuntu-18-04"}),"How to secure apache with let's encrypt on ubuntu 18.04"))),Object(i.b)("p",null,"And used ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"https://www.jatos.org/JATOS-on-a-server.html"}),"https://www.jatos.org/JATOS-on-a-server.html")," to finalize the installation."),Object(i.b)("p",null,"The DNS configuration is all explained here"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("a",Object(a.a)({parentName:"li"},{href:"https://www.digitalocean.com/docs/networking/dns/quickstart/"}),"https://www.digitalocean.com/docs/networking/dns/quickstart/")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("a",Object(a.a)({parentName:"li"},{href:"https://www.digitalocean.com/community/tutorials/how-to-point-to-digitalocean-nameservers-from-common-domain-registrars#registrar-gandi"}),"https://www.digitalocean.com/community/tutorials/how-to-point-to-digitalocean-nameservers-from-common-domain-registrars#registrar-gandi"))),Object(i.b)("p",null,"Starting a service at reboot is explained here"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("a",Object(a.a)({parentName:"li"},{href:"https://www.digitalocean.com/community/tutorials/how-to-configure-a-linux-service-to-start-automatically-after-a-crash-or-reboot-part-1-practical-examples"}),"https://www.digitalocean.com/community/tutorials/how-to-configure-a-linux-service-to-start-automatically-after-a-crash-or-reboot-part-1-practical-examples"),")")),Object(i.b)("p",null,"Recently, I went a step further and installed on a dedicated server the MySQL database that JATOS uses. For this, I went for the DigitalOcean server option called ",Object(i.b)("strong",{parentName:"p"},"Managed Databases")," (daily backup and redundancy). To use this integrated service, I needed to upgrade the MySQL version to v.8, set the correct port of communication, and transfer the JATOS database, knowing there would be no ssh access to the database server. I used Oracle WorkBench for this latter operation (the sole software that allowed the particular connection needed AND that could deal with the import/export of a large database)."),Object(i.b)("p",null,"The total cost of the actual configuration is about 50 EUR a month."),Object(i.b)("div",{className:"admonition admonition-important alert alert--info"},Object(i.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-heading"}),Object(i.b)("h5",{parentName:"div"},Object(i.b)("span",Object(a.a)({parentName:"h5"},{className:"admonition-icon"}),Object(i.b)("svg",Object(a.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(i.b)("path",Object(a.a)({parentName:"svg"},{fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"})))),"important")),Object(i.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-content"}),Object(i.b)("p",{parentName:"div"},"The sections below are not self-sufficient. If you are interested in hosting your own implementation of JATOS, read the tutorials first. They are much more detailed and the explanation are great. The content below is a command list for the ILCB service administrators, but you are free to use it!"))),Object(i.b)("h2",{id:"digitalocean-manipulations"},"DigitalOcean manipulations"),Object(i.b)("h3",{id:"droplet-creation"},"Droplet creation"),Object(i.b)("p",null,"On DigitalOcean, I created a droplet (a virtual server) this way:"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"create a droplet")),Object(i.b)("p",null,Object(i.b)("img",Object(a.a)({parentName:"p"},{src:"/img/server-create-droplet.png",alt:"create droplet"}))),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"choose in Marketplace a LAMP option amongst the proposed initial configurations.")),Object(i.b)("p",null,Object(i.b)("img",Object(a.a)({parentName:"p"},{src:"/img/server-marketplace.png",alt:"create droplet"}))),Object(i.b)("p",null,Object(i.b)("img",Object(a.a)({parentName:"p"},{src:"/img/server-lamp.png",alt:"create droplet"}))),Object(i.b)("p",null,"This went with the following piece of software"),Object(i.b)("p",null,Object(i.b)("img",Object(a.a)({parentName:"p"},{src:"/img/server-preinstalled-software.png",alt:"create droplet"}))),Object(i.b)("p",null,"Before clicking on create, I selected some required options such as the plan (from 5$ a month), the location (worldwide choice including Europe), a monitoring / backup option and a password if needed."),Object(i.b)("p",null,"then"),Object(i.b)("p",null,Object(i.b)("img",Object(a.a)({parentName:"p"},{src:"/img/server-create.png",alt:"create droplet"}))),Object(i.b)("p",null,"The virtual server is created within a minute and is managed in the home page of your DigitalOcean account. You can destroy this server within seconds so no worries if something is not setup correctly. One can always create a new droplet easily."),Object(i.b)("p",null,"In the initial configuration, the UFW firewall is set to \u201cactive\u201d with restrictions on all the ports except SSH (port 22), HTTP (port 80) and HTTPS (port 443). You can disable this firewall service and use instead the DigitalOcean firewall solution (button \u201ccreate\u201d then \u201cCloud Firewalls\u201d). Both choices are fine."),Object(i.b)("p",null,Object(i.b)("img",Object(a.a)({parentName:"p"},{src:"/img/server-firewall.png",alt:"create droplet"}))),Object(i.b)("h3",{id:"initial-server-configuration"},"Initial server configuration"),Object(i.b)("p",null,"Following the DigitalOcean tutorial on ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"https://www.digitalocean.com/community/tutorials/initial-server-setup-with-ubuntu-18-04"}),"How to setup a server with Ubuntu 18.04"),", I configured the server with some command lines executed in the console, either on the DigitalOcean website or in the Linux/MacOS terminal."),Object(i.b)("p",null,"Log in :"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"ssh root@<IP address>\n")),Object(i.b)("p",null,"Answer \u201cyes\u201d to continue connecting then type the actual  password. You are asked to change the root password (enter it twice)."),Object(i.b)("p",null,"Create a super-user with admin privileges"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"adduser mysuperuser\nusermod -aG sudo mysuperuser\n")),Object(i.b)("p",null,"You can delete the root account once you are sure that mysuperuser is able to perform sudo operations (Super User DO)."),Object(i.b)("p",null,"Verify the firewall settings with"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"ufw status\n")),Object(i.b)("p",null,"The ports that we need to communicate with are opened (22, 80, 443), all in IP v4 and v6."),Object(i.b)("h2",{id:"apache-configuration"},"Apache configuration"),Object(i.b)("p",null,"I followed the DigitalOcean tutorial on ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"https://www.digitalocean.com/community/tutorials/how-to-set-up-apache-virtual-hosts-on-ubuntu-16-04"}),"How to setup virtual hosts"),"."),Object(i.b)("p",null,"The web server is Apache2, located at ",Object(i.b)("inlineCode",{parentName:"p"},"/etc/apache2/"),"."),Object(i.b)("h3",{id:"initial-steps"},"Initial steps"),Object(i.b)("p",null,"I created a main site \u201cilcb-online-test.net\u201d and its alias \u201c",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"http://www.ilcb-online-test.net%E2%80%9D"}),"www.ilcb-online-test.net\u201d")," (that points to the main site), along with some extra sub-site located in the sub-domain such as the one you are reading the docs on \u201cdocs.ilcb-online-test.net\u201d or the one dedicated to JATOS."),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"sudo mkdir -p /var/www/ilcb-online-test.net/public_html\nsudo mkdir -p /var/www/docs.ilcb-online-test.net/public_html\nsudo mkdir -p /var/www/jatos.ilcb-online-test.net/public_html\n")),Object(i.b)("p",null,"I then gave some rights to the actual user (change owner)"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"sudo chown -R $USER:$USER /var/www/ilcb-online-test.net/public_html\nsudo chown -R $USER:$USER /var/www/docs.ilcb-online-test.net/public_html\nsudo chown -R $USER:$USER /var/www/jatos.ilcb-online-test.net/public_html\n")),Object(i.b)("p",null,"And changed the write permissions"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"sudo chmod -R 755 /var/www\n")),Object(i.b)("div",{className:"admonition admonition-note alert alert--secondary"},Object(i.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-heading"}),Object(i.b)("h5",{parentName:"div"},Object(i.b)("span",Object(a.a)({parentName:"h5"},{className:"admonition-icon"}),Object(i.b)("svg",Object(a.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(i.b)("path",Object(a.a)({parentName:"svg"},{fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"})))),"note")),Object(i.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-content"}),Object(i.b)("p",{parentName:"div"},"Instead of using nano, you can use an FTP client (FileZilla, CyberDuck) to log to the server, and directly create or modify the directory structure or the files, including their content and permissions."))),Object(i.b)("p",null,"In the terminal, I opened the nano editor to create the ",Object(i.b)("inlineCode",{parentName:"p"},"index.html")," file"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{})," nano /var/www/ilcb-online-test.net/public_html/index.html\n")),Object(i.b)("p",null,"and gave it some initial content"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"<html>\n  <head>\n    <title>Welcome to ilcb.com!</title>\n  </head>\n  <body>\n    <h1>Success!  The ilcb.com is working!</h1>\n  </body>\n</html>\n")),Object(i.b)("p",null,"I copied the content of this file to the other locations"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"cp /var/www/ilcb-online-test.net/public_html/index.html /var/www/jatos.ilcb-online-test.net/public_html/index.html\n")),Object(i.b)("p",null,"and enabled the web service for these addresses, first by copying a configuration file (for the main domain and the subdomains)"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"sudo cp /etc/apache2/sites-available/000-default.conf /etc/apache2/sites-available/ilcb-online-test.net.conf\n")),Object(i.b)("p",null,"and modifying it"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"sudo nano /etc/apache2/sites-available/ilcb-online-test.net.conf\n")),Object(i.b)("p",null,"I enabled the service"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"sudo a2ensite ilcb-online-test.net.conf\nsudo apache2ctl configtest\nsudo a2dissite 000-default.conf\n")),Object(i.b)("div",{className:"admonition admonition-important alert alert--info"},Object(i.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-heading"}),Object(i.b)("h5",{parentName:"div"},Object(i.b)("span",Object(a.a)({parentName:"h5"},{className:"admonition-icon"}),Object(i.b)("svg",Object(a.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(i.b)("path",Object(a.a)({parentName:"svg"},{fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"})))),"important")),Object(i.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-content"}),Object(i.b)("p",{parentName:"div"},"DigitalOcean was setup to manage the domain and subdomains (NS, A and CNAME  DNS records). See the tutorials at the begining of the page."))),Object(i.b)("h3",{id:"encryption"},"Encryption"),Object(i.b)("p",null,"I setup and https encryption with Let's Encrypt following the DigitalOcean tutorial on ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"https://www.digitalocean.com/community/tutorials/how-to-secure-apache-with-let-s-encrypt-on-ubuntu-18-04"}),"How to secure apache with let's encrypt on ubuntu 18.04")),Object(i.b)("p",null,"Verified that ",Object(i.b)("inlineCode",{parentName:"p"},"certbot")," is installed and ",Object(i.b)("inlineCode",{parentName:"p"},"Apache")," is correctly running"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"sudo apache2ctl configtest\n")),Object(i.b)("p",null,"Then enabled https for the domain and sub-domains"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"sudo certbot --apache -d ilcb-online-test.net -d www.ilcb-online-test.net\n")),Object(i.b)("p",null,"To update a new subdomain :"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"sudo certbot --duplicate --apache -d ilcb-online-test.net -d www.ilcb-online-test.net\n")),Object(i.b)("div",{className:"admonition admonition-note alert alert--secondary"},Object(i.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-heading"}),Object(i.b)("h5",{parentName:"div"},Object(i.b)("span",Object(a.a)({parentName:"h5"},{className:"admonition-icon"}),Object(i.b)("svg",Object(a.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(i.b)("path",Object(a.a)({parentName:"svg"},{fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"})))),"note")),Object(i.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-content"}),Object(i.b)("p",{parentName:"div"},"You can test your configuration on\n",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"https://www.ssllabs.com/ssltest/analyze.html?d=jatos.ilcb-online-test.net"}),"https://www.ssllabs.com/ssltest/analyze.html?d=jatos.ilcb-online-test.net")))),Object(i.b)("p",null,"The ",Object(i.b)("inlineCode",{parentName:"p"},"certbot")," operation adds a new ",Object(i.b)("inlineCode",{parentName:"p"},".conf")," file dedicated to the encrypted communication. The HTTP (port 80) is completed with"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"RewriteEngine on\nRewriteCond %{SERVER_NAME} =ilcb-online-test.net [OR]\nRewriteCond %{SERVER_NAME} =www.ilcb-online-test.net\nRewriteRule ^ https://%{SERVER_NAME}%{REQUEST_URI} [END,NE,R=permanent]\n")),Object(i.b)("p",null,"The new HTTPS (port 433) is"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"<IfModule mod_ssl.c>\n  <VirtualHost *:443>\n\n        ServerAdmin admin@ilcb-online-test.net\n        ServerName ilcb-online-test.net\n        ServerAlias www.ilcb-online-test.net\n\n        DocumentRoot /var/www/ilcb-online-test.net/public_html\n\n        ErrorLog ${APACHE_LOG_DIR}/error.log\n        CustomLog ${APACHE_LOG_DIR}/access.log combined\n\n        Include /etc/letsencrypt/options-ssl-apache.conf\n        SSLCertificateFile /etc/letsencrypt/live/ilcb-online-test.net/fullchain.pem\n        SSLCertificateKeyFile /etc/letsencrypt/live/ilcb-online-test.net/privkey.pem\n\n  </VirtualHost>\n</IfModule>\n")),Object(i.b)("h2",{id:"install-java"},"Install Java"),Object(i.b)("p",null,"JATOS runs with Java, which is not installed by defaults."),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"java -version\n")),Object(i.b)("p",null,'should output "unknown command"'),Object(i.b)("p",null,"To install Java:"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"sudo apt-get update\nsudo apt-get install openjdk-8-jre\n")),Object(i.b)("p",null,"that installed JAVA 8 JRE."),Object(i.b)("h2",{id:"setup-mysql-for-jatos"},"Setup MySQL for JATOS"),Object(i.b)("p",null,"From ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"https://www.jatos.org/JATOS-on-a-server.html"}),"https://www.jatos.org/JATOS-on-a-server.html")),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"sudo mysql -u root -p\n\nCREATE USER 'jatosuser'@'localhost' IDENTIFIED BY \u2018password\u2019;\nGRANT SELECT, INSERT, UPDATE ON jatos.* TO 'jatosuser'@'localhost';\n")),Object(i.b)("h3",{id:"setup-phpmyadmin-or-adminer"},"Setup PhpMyAdmin or Adminer"),Object(i.b)("p",null,"Following the DigitalOcean tutorial ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"https://www.digitalocean.com/community/tutorials/how-to-install-and-secure-phpmyadmin-on-ubuntu-18-04"}),"Install phpMyAdmin"),"."),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"sudo apt update\nsudo apt install phpmyadmin php-mbstring php-gettext\n\nALTER USER 'root'@'localhost' IDENTIFIED WITH mysql_native_password BY 'password';\n")),Object(i.b)("h2",{id:"install-jatos"},"Install JATOS"),Object(i.b)("h3",{id:"download"},"Download"),Object(i.b)("p",null,"I downloaded and installed JATOS with (see the tutorial ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"https://www.jatos.org/JATOS-on-a-server.html"}),"https://www.jatos.org/JATOS-on-a-server.html"),")"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"wget https://github.com/JATOS/JATOS/releases/download/v3.2.1/jatos-3.2.1.zip\n")),Object(i.b)("p",null,"or grab some more recent version: ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"https://github.com/JATOS/JATOS/releases/download/v3.3.6/jatos-3.3.6.zip"}),"https://github.com/JATOS/JATOS/releases/download/v3.3.6/jatos-3.3.6.zip")),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"sudo apt-get install unzip\nunzip jatos\nsudo chmod +x jatos-3.3.6/loader.sh\n")),Object(i.b)("p",null,"Changed the proxy settings"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"ProxyRequests Off\nProxyPreserveHost On\nProxyPass / http://xp.ilcb-online-test.net:9000/\nProxyPassReverse / http://xp.ilcb-online-test.net:9000/\n")),Object(i.b)("p",null,"At this point, you should have some additional firewall rules dedidated to MySQL (port 3306) and JATOS (port 9000). If you went for the firewall managed by DigitalOcean, remember to shut the inner UFW Service"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"sudo ufw disable\n")),Object(i.b)("p",null,"Checked that you have set the correct configuration for JATOS and MySQL"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"# If you use JATOS with an MySQL database use\nAfter=network-online.target mysql.service\n")),Object(i.b)("h3",{id:"enable-jatos-service-after-reboot"},"Enable JATOS service after reboot"),Object(i.b)("p",null,"Services are in ",Object(i.b)("inlineCode",{parentName:"p"},"/etc/systemd/system/multi-user.target.wants/service.service")),Object(i.b)("p",null,"To enable/disable a service"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"sudo systemctl enable /etc/systemd/system/multi-user.target.wants/service.service\n\nsudo systemctl status jatos.service\nsudo systemctl stop jatos.service\nsudo systemctl enable jatos.service\nsudo systemctl daemon-reload\n")),Object(i.b)("p",null,"At this point, you should have a JATOS server running on a DigitalOcean droplet. Phew !"),Object(i.b)("p",null,Object(i.b)("img",Object(a.a)({parentName:"p"},{src:"/img/server-jatos.png",alt:"create droplet"}))),Object(i.b)("h2",{id:"useful-command-lines"},"Useful command lines"),Object(i.b)("p",null,"To change right access to a particular folder/particular user:"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"sudo chown -R myuser:myuser /var/www/mysubdomain.ilcb-online-test.net/\n")),Object(i.b)("p",null,"To upadate a new subdomain, here is the actual list"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"sudo certbot --duplicate --apache -d ilcb-online-test.net -d www.ilcb-online-test.net -d test.ilcb-online-test.net -d playground.ilcb-online-test.net -d jatos.ilcb-online-test.net -d reprea.ilcb-online-test.net -d xp.ilcb-online-test.net -d ibm.ilcb-online-test.net -d kids.ilcb-online-test.net -d docs.ilcb-online-test.net\n")),Object(i.b)("p",null,"To create a database and a newuser"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"CREATE USER 'newuser'@'localhost' IDENTIFIED BY \u2018xxx\u2019;\nGRANT SELECT, INSERT, UPDATE, DELETE ON  `newuser`.* TO 'newuser'@'%';\n")),Object(i.b)("p",null,"To change the Hostname"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"sudo hostname ilcb-online-test.net\nsudo sendmailconfig\nservice apache2 restart\n")))}b.isMDXComponent=!0},175:function(e,t,n){"use strict";n.d(t,"a",(function(){return p})),n.d(t,"b",(function(){return m}));var a=n(0),o=n.n(a);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var s=o.a.createContext({}),b=function(e){var t=o.a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):c({},t,{},e)),n},p=function(e){var t=b(e.components);return o.a.createElement(s.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return o.a.createElement(o.a.Fragment,{},t)}},u=Object(a.forwardRef)((function(e,t){var n=e.components,a=e.mdxType,i=e.originalType,r=e.parentName,s=l(e,["components","mdxType","originalType","parentName"]),p=b(n),u=a,m=p["".concat(r,".").concat(u)]||p[u]||d[u]||i;return n?o.a.createElement(m,c({ref:t},s,{components:n})):o.a.createElement(m,c({ref:t},s))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=n.length,r=new Array(i);r[0]=u;var c={};for(var l in t)hasOwnProperty.call(t,l)&&(c[l]=t[l]);c.originalType=e,c.mdxType="string"==typeof e?e:a,r[1]=c;for(var s=2;s<i;s++)r[s]=n[s];return o.a.createElement.apply(null,r)}return o.a.createElement.apply(null,n)}u.displayName="MDXCreateElement"}}]);